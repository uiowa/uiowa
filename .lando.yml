name: uiowa
recipe: drupal9

proxy:
  appserver:
    - uiowa.lndo.site
    - "*.uiowa.lndo.site"

config:
  webroot: docroot
  php: '7.4'
  via: apache
  drupal: false
  drush: false
  xdebug: true
  ssl: false
  database: mysql

services:
  cache:
    type: memcached:1
  appserver:
    build_as_root:
      - curl -sL https://deb.nodesource.com/setup_14.x | bash -
      - apt-get install -y nodejs
      - npm i -g corepack
    overrides:
      environment:
        PHP_IDE_CONFIG: serverName=uiowa.lndo.site
        SIMPLETEST_BASE_URL: https://uiowa.lndo.site
        SIMPLETEST_DB: mysql://drupal9:drupal9@database/drupal9
        SYMFONY_DEPRECATIONS_HELPER: disabled

events:
  post-start:
    - appserver: cd $LANDO_MOUNT && composer install --no-suggest

tooling:
  drush:
    cmd: /app/drush/drush.sh
  blt:
    service: appserver
    cmd: /app/vendor/bin/blt
