language: php
dist: xenial
php: '7.3'

env:
  global:
    - COMPOSER_BIN=$TRAVIS_BUILD_DIR/vendor/bin
    - BLT_DIR=$TRAVIS_BUILD_DIR/vendor/acquia/blt

cache:
  directories:
    - "$HOME/.composer/cache"
    - "$HOME/.drush/cache"
    - "$TRAVIS_BUILD_DIR/node_modules/"

services:
  - mysql

addons:
  ssh_known_hosts:
    - svn-14671.prod.hosting.acquia.com
    - svn-29892.prod.hosting.acquia.com

notifications:
  slack:
    secure: V8Nr6cojYz8k3uek2GcsIlcCkTe+mSUQ60xy6Zym5t2xxKGBFkEUy+lQ2/ZaQzvyvz/nqGjhDmKAcCPg6xfz+xtwAqjlhkGhWfBsvHPBXz9GkeF7ZXIJ8cjP76Xu7d9/BFY0CvE3xz/MHovvOPHrMSo7/hEIr6/Y/FuSFJmPyZNX0PXGF4z9UVGtLNmWl0NHDIu+ZFftzI6tP5YgRmztpd85Z9IkqUtr63ofA2Oqjfe4uxs0+ewxVTUvS8+yLZvzAXX37Qt3vmtddMUHbCRKlLAeMRfQNkFxXHKfFd6w2CgtMXMrpxzOnETniVc0j2N2jPWKnYuKaqEvIaR8+rO49EEI3rV5DE9Ydz8NBsWiLioz0EtBSlOGWq6OMW+lA+s8Zxsu2zk4E2Amk9yCaR7VXUCZN0yfZJnHUfIEFC0kEuJx0Zuc6o4oosWOzCjvLnhA/6CiebuX+KqVEPhfZsE/ptTkr+6Ty7sGpswruSRxf3bEHqKaDYUgBFj8qIaQXfDAxRBXBlQBqH8FCs4BXhWd11bt7dv3SCehqvpOGks+6gudExucWfb+6zF+AAmjLOUUryW113wgYCq6gN9tCiQce6cMv2Jvh5UHWZypkgeQFiOjqK1rMrawq8YJS2A37vzIbuG56eL+x6vXZ88fZKvlyPahJLXoPgGgAuIjIB2eofs=
    if: branch = master
    on_success: change
    on_failure: always

before_install:
  - openssl aes-256-cbc -K $encrypted_8bb691529416_key -iv $encrypted_8bb691529416_iv
    -in deploy_key.enc -out deploy_key -d
  - mv deploy_key $HOME/.ssh/id_rsa
  - chmod 600 $HOME/.ssh/id_rsa
  - phpenv config-rm xdebug.ini
  - yes | pecl install memcache
  - composer self-update
  - composer global require hirak/prestissimo

install:
  - nvm install 10
  - nvm use 10
  - composer install
  - source ${BLT_DIR}/scripts/travis/exit_early
  - source ${BLT_DIR}/scripts/travis/setup_environment
  - source ${BLT_DIR}/scripts/travis/setup_project

script:
  - source ${TRAVIS_BUILD_DIR}/tests/travis_run_tests

deploy:
  - provider: script
    script: "${BLT_DIR}/scripts/travis/deploy_branch"
    skip_cleanup: true
    on:
      branch: develop
      php: 7.3
  - provider: script
    script: "${BLT_DIR}/scripts/travis/deploy_branch"
    skip_cleanup: true
    on:
      branch: master
      php: 7.3
  - provider: script
    script: "${BLT_DIR}/scripts/travis/deploy_tag"
    skip_cleanup: true
    on:
      tags: true
      php: 7.3
